<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ETHEREAL FREAKS - The Multichrome Realm</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load League Spartan (or similar blocky, bold font) and Inter -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=League+Spartan:wght@700;800;900&family=Inter:wght@300;400;500;700&display=swap');
        
        /* Base Colors - WHITE BACKGROUND WITH NEON ACCENT */
        :root {
            --color-bg-light: #FFFFFF; /* White background */
            --color-card-bg: #F8F8F8; /* Slight off-white for cards */
            --color-text-dark: #101018;
            --color-accent-neon: #00AFFF; /* NEON BLUE / CYAN (Main Accent) */
            --color-accent-green: #D1FF66; /* NEW NEON GREEN ACCENT (Button/Highlight) */
            --color-border: #E0E0E0; /* Light border */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light) !important;
            color: var(--color-text-dark);
            cursor: default;
            overflow-x: hidden;
        }

        .header-font {
            font-family: 'League Spartan', sans-serif;
            letter-spacing: -0.05em; 
        }

        /* Structured Product Card Styling */
        .product-card {
            background-color: var(--color-card-bg);
            border-radius: 0.5rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            position: relative; 
            z-index: 20; 
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 175, 255, 0.4); 
            border-color: var(--color-accent-neon); 
        }

        .product-content {
            padding: 0 1rem 1rem 1rem; 
        }
        
        /* Image swap classes */
        .product-image-swap {
            transition: opacity 0.3s ease-in-out;
            min-height: 250px;
            height: 250px; 
            object-fit: contain; 
            padding: 1rem;
            background-color: #F0F0F0;
            transition: opacity 0.2s ease-in-out; 
        }
        
        /* Swatch Trail Styling */
        #swatch-trail-container {
            pointer-events: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 50; 
        }

        .swatch-blob {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            opacity: 0;
            filter: blur(5px);
            transition: opacity 0.5s, transform 0.5s;
            animation: pulse 3s infinite alternate;
        }

        @keyframes pulse {
            0% { transform: translateY(0); }
            100% { transform: translateY(0); }
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-bg-light); }
        ::-webkit-scrollbar-thumb { background: var(--color-accent-neon); border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #00DDEE; }

        /* Floating Objects Animation */
        @keyframes float {
            0% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
            100% { transform: translateY(0); }
        }

        .floating-asset {
            position: fixed;
            z-index: 9999;
            opacity: 0.9;
            filter: drop-shadow(0 0 8px var(--color-accent-neon)); 
            pointer-events: none;
        }

        .floating-asset-img { height: 80px; width: 80px; }
        .floating-asset-1 { top: 15%; left: 10%; animation: float 10s ease-in-out infinite; }
        .floating-asset-2 { top: 70%; right: 2%; animation: float 12s ease-in-out infinite reverse; transform: scaleX(-1); }
        .floating-asset-3 { bottom: 10%; left: 5%; animation: float 8s ease-in-out infinite; }

        /* Cart and Controls */
        .quantity-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100px;
            height: 36px;
            background-color: var(--color-accent-green);
            border-radius: 9999px;
            overflow: hidden;
            position: relative;
            z-index: 60;
            pointer-events: auto;
        }

        .quantity-btn {
            background: none;
            border: none;
            color: #000;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            padding: 0 12px;
            height: 100%;
            transition: background-color 0.2s;
            line-height: 36px; 
            pointer-events: auto;
        }
        .quantity-btn:hover { background-color: #B0E040; }
        .quantity-display { color: #000; font-weight: 500; font-size: 14px; padding: 0 4px; }
        
        .initial-cart-btn {
             background-color: var(--color-accent-green);
             transition: background-color 0.2s;
             position: relative;
             z-index: 60;
             pointer-events: auto;
        }
        .initial-cart-btn:hover { background-color: #B0E040; }
        
        /* Carousel specific styling */
        .carousel-wrapper {
            position: relative;
            min-height: 250px;
            z-index: 30;
        }
        .carousel-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            z-index: 40;
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--color-text-dark);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            cursor: pointer;
            transition: opacity 0.3s, background-color 0.2s;
            line-height: 1;
            opacity: 0;
            pointer-events: auto;
        }
        .carousel-wrapper:hover .carousel-arrow { opacity: 1; }
        .carousel-arrow:hover { background-color: var(--color-accent-green); }
        .carousel-arrow.left { left: 10px; }
        .carousel-arrow.right { right: 10px; }
        
        /* Marquee Animation CSS for seamless loop */
        @keyframes scroll-left {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); } 
        }
        .marquee-container {
            width: 100%;
            overflow: hidden; /* Hide the duplicated content part */
        }
        .marquee-content {
            display: flex;
            width: 200%; /* Total width to hold two copies of the text */
            animation: scroll-left 15s linear infinite; 
        }
        .marquee-text-item {
            width: 50%; /* Each item takes half the container width */
            flex-shrink: 0;
            white-space: nowrap;
            font-family: 'League Spartan', sans-serif;
            font-weight: 800;
            text-align: center; 
            padding-right: 40px; /* Gap between repeats */
        }

        /* --- REFLEX GAME STYLING --- */
        #reflex-game-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            background: #d77fdb; 
            border: 2px solid white;
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 0 25px rgba(215, 127, 219, 0.5);
        }
        .reflex-track {
            position: relative;
            width: 100%;
            height: 30px;
            background: #2a1b2e; 
            border-radius: 15px;
            margin: 20px 0;
            overflow: hidden;
            box-shadow: inset 0 0 10px #000;
        }
        .reflex-zone-win {
            position: absolute;
            left: 50%; /* Default, will be overridden by JS */
            top: 0; bottom: 0;
            width: 5%; 
            background: var(--color-accent-green);
            transform: translateX(-50%);
            z-index: 1;
            box-shadow: 0 0 10px var(--color-accent-green);
        }
        .reflex-zone-near {
            position: absolute;
            left: 50%; /* Default, will be overridden by JS */
            top: 0; bottom: 0;
            width: 30%; 
            /* BLUE ZONE - OPACITY REMOVED FOR SOLID COLOR */
            background: var(--color-accent-neon); 
            transform: translateX(-50%);
            opacity: 1; 
        }
        .reflex-cursor {
            position: absolute;
            top: 0; bottom: 0; left: 0;
            width: 6px;
            background: white;
            z-index: 2;
            box-shadow: 0 0 8px white;
            border-radius: 2px;
        }
        .game-btn {
            background-color: white;
            color: var(--color-text-dark);
            font-family: 'League Spartan', sans-serif;
            font-weight: bold;
            padding: 12px 40px;
            font-size: 1.2rem;
            border-radius: 99px;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
            border: none;
        }
        .game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255,255,255,0.8);
        }
        .game-btn:disabled {
            background-color: #888;
            color: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* --- POPUP MODAL STYLING WITH CONFETTI --- */
        #claim-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(4px);
            z-index: 1;
        }
        #confetti-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 2; /* Between overlay and content */
            overflow: hidden;
        }
        .modal-content {
            position: relative;
            background-color: var(--color-bg-light);
            border: 2px solid var(--color-accent-neon);
            border-radius: 1rem;
            padding: 2.5rem;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 3; /* Top most */
        }
        @keyframes popIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        /* CONFETTI ANIMATION */
        .confetto {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0;
            border-radius: 2px;
            animation: explode 1.5s ease-out forwards;
        }

        @keyframes explode {
            0% { transform: translate(-50%, -50%) rotate(0); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) rotate(var(--r)); opacity: 0; }
        }

        /* --- CART SIDEBAR STYLING --- */
        #cart-sidebar {
            position: fixed;
            top: 0;
            right: -450px; /* Hidden initially */
            width: 400px;
            height: 100%;
            background: white;
            z-index: 20000; /* Highest z-index */
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
            border-left: 2px solid var(--color-accent-neon);
        }

        #cart-sidebar.open {
            right: 0;
        }

        .cart-header {
            padding: 20px;
            border-bottom: 1px solid var(--color-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--color-card-bg);
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .cart-footer {
            padding: 20px;
            border-top: 1px solid var(--color-border);
            background: var(--color-card-bg);
        }

        .cart-item {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            border-bottom: 1px dashed #ddd;
            padding-bottom: 15px;
        }

        .cart-item img {
            width: 70px;
            height: 70px;
            object-fit: cover;
            border-radius: 4px;
            border: 1px solid #eee;
        }

        /* CHECKOUT MODAL */
        #checkout-modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 10000;
            align-items: center;
            justify-content: center;
        }

        /* CATEGORY BANNER */
        #category-banner {
            display: none; /* Hidden by default */
            background: black;
            color: var(--color-accent-neon);
            text-align: center;
            padding: 4rem 0;
            border-bottom: 2px solid var(--color-accent-green);
        }
    </style>
</head>
<body class="min-h-screen">

    <div id="swatch-trail-container"></div>
    
    <!-- CLAIM MODAL -->
    <div id="claim-modal">
        <div class="modal-overlay" onclick="closeModal('claim-modal')"></div>
        <!-- Confetti Container Added Here -->
        <div id="confetti-container"></div>
        <div class="modal-content">
            <span class="absolute top-2 right-4 text-2xl cursor-pointer hover:text-red-500" onclick="closeModal('claim-modal')">&times;</span>
            <h3 class="header-font text-3xl mb-2 text-[var(--color-accent-neon)]">CONGRATS!</h3>
            <p class="text-gray-600 mb-6">You got:</p>
            <div id="claim-prize-text" class="text-2xl font-bold mb-8 text-[var(--color-text-dark)]"></div>
            <button onclick="closeModal('claim-modal')" class="bg-[var(--color-accent-green)] text-black font-bold py-3 px-8 rounded-full hover:bg-[#b0e040] transition shadow-lg w-full">
                CLAIM IT
            </button>
        </div>
    </div>

    <!-- CHECKOUT MODAL -->
    <div id="checkout-modal">
        <div class="modal-overlay" onclick="document.getElementById('checkout-modal').style.display='none'"></div>
        <div class="modal-content text-left">
             <span class="absolute top-2 right-4 text-2xl cursor-pointer hover:text-red-500" onclick="document.getElementById('checkout-modal').style.display='none'">&times;</span>
             <h3 class="header-font text-2xl mb-6 text-center text-[var(--color-accent-neon)]">CHECKOUT</h3>
             <form id="checkout-form" onsubmit="event.preventDefault(); alert('Order Placed! (Simulated)'); document.getElementById('checkout-modal').style.display='none';">
                 <div class="mb-4">
                     <label class="block text-sm font-bold mb-2">Email Address</label>
                     <input type="email" required class="w-full p-2 border rounded bg-gray-50 focus:outline-none focus:border-[var(--color-accent-neon)]">
                 </div>
                 <div class="mb-4">
                     <label class="block text-sm font-bold mb-2">Voucher Code</label>
                     <input type="text" id="checkout-voucher" placeholder="Optional" class="w-full p-2 border rounded bg-gray-50">
                 </div>
                 <div class="mb-4">
                     <label class="block text-sm font-bold mb-2">Payment Method</label>
                     <select class="w-full p-2 border rounded bg-gray-50">
                         <option>Credit Card</option>
                         <option>Debit Card</option>
                         <option>Apple Pay</option>
                         <option>Google Pay</option>
                         <option>Bank Transfer</option>
                         <option>OVO</option>
                         <option>GoPay</option>
                         <option>ShopeePay</option>
                     </select>
                 </div>
                 <div class="mb-6">
                     <label class="block text-sm font-bold mb-2">Shipping Address</label>
                     <textarea required rows="3" class="w-full p-2 border rounded bg-gray-50"></textarea>
                 </div>
                 <button type="submit" class="w-full bg-[var(--color-accent-green)] text-black font-bold py-3 rounded-full hover:bg-[#b0e040] transition">PAY NOW</button>
             </form>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div id="cart-sidebar">
        <div class="cart-header">
            <h3 class="header-font text-xl text-[var(--color-text-dark)]">MY CART</h3>
            <span class="text-3xl cursor-pointer hover:text-red-500" onclick="toggleCart()">&times;</span>
        </div>
        <div class="cart-items" id="cart-items-container">
            <!-- Items injected here -->
        </div>
        <div class="cart-footer">
            <div class="flex justify-between items-center mb-4">
                <span class="font-bold">TOTAL</span>
                <span class="font-bold text-xl" id="cart-total">IDR 0</span>
            </div>
            
            <div class="flex items-center gap-2 mb-4 p-2 bg-gray-100 rounded">
                <input type="checkbox" id="use-coins" onchange="renderCartItems()">
                <label for="use-coins" class="text-sm cursor-pointer select-none">Use 100 Coins (- IDR 10.000)</label>
            </div>

            <button onclick="openCheckout()" class="w-full bg-[var(--color-accent-neon)] text-white font-bold py-3 rounded-full hover:bg-[#008cba] transition shadow-lg">BUY NOW</button>
        </div>
    </div>

    <div class="floating-asset floating-asset-1"><img src="https://dinopixel.com/preload/0923/pixel-art-1694273804.webp" class="floating-asset-img" alt="Asset 1"></div>
    <div class="floating-asset floating-asset-2"><img src="https://dinopixel.com/preload/0923/pixel-art-1694273804.webp" class="floating-asset-img" alt="Asset 2"></div>
    <div class="floating-asset floating-asset-3 hidden lg:block"><img src="https://dinopixel.com/preload/0923/pixel-art-1694273804.webp" class="floating-asset-img" alt="Asset 3"></div>

    <header class="sticky top-0 z-40 bg-[var(--color-card-bg)]/90 backdrop-blur-sm shadow-md shadow-[#EAEAEA] border-b border-[var(--color-border)]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center">
            <h1 class="text-3xl font-black header-font text-[var(--color-accent-neon)] hover:text-[#00DDEE] transition duration-300 cursor-pointer" onclick="filterCategory('all')">
                ETHEREAL FREAKS
            </h1>
            <nav class="space-x-8 hidden md:flex">
                <button onclick="filterCategory('featured')" class="text-sm font-medium hover:text-[var(--color-accent-neon)] transition duration-200 text-[var(--color-text-dark)] uppercase">New Drop</button>
                <button onclick="filterCategory('eyes')" class="text-sm font-medium hover:text-[var(--color-accent-neon)] transition duration-200 text-[var(--color-text-dark)] uppercase">Eye Palettes</button>
                <button onclick="filterCategory('lips')" class="text-sm font-medium hover:text-[var(--color-accent-neon)] transition duration-200 text-[var(--color-text-dark)] uppercase">Lip Veils</button>
                <button onclick="filterCategory('contour')" class="text-sm font-medium hover:text-[var(--color-accent-neon)] transition duration-200 text-[var(--color-text-dark)] uppercase">Sculpting</button>
                <button onclick="toggleCart()" id="cart-link" class="text-sm font-medium text-[var(--color-accent-neon)] border border-[var(--color-accent-neon)] px-3 py-1 rounded-full hover:bg-[var(--color-accent-neon)] hover:text-white transition duration-200 uppercase">
                    CART (0)
                </button>
            </nav>
            <button class="md:hidden text-2xl text-[var(--color-accent-neon)]">&#9776;</button>
        </div>
    </header>

    <section id="category-banner">
        <h2 id="category-title" class="header-font text-5xl text-white font-bold tracking-widest drop-shadow-lg"></h2>
    </section>

    <section id="hero-section" class="relative h-[60vh] md:h-[80vh] flex items-center justify-center overflow-hidden border-b border-[var(--color-border)]">
        <img src="https://i.pinimg.com/736x/c0/4b/e3/c04be378cf0adcb642ae7a0d539db245.jpg" 
             onerror="this.onerror=null; this.src='https://placehold.co/1920x800/FFFFFF/00AFFF?text=ETHEREAL+FREAKS';"
             alt="Hero" class="absolute inset-0 w-full h-full object-cover transition-opacity duration-1000">
        <div class="relative z-10 text-center px-4">
            <h2 class="header-font text-5xl md:text-7xl font-extrabold text-[#D1FF66] drop-shadow-lg shadow-gray-400/50">DIMENSIONAL LUSTER</h2>
            <p class="mt-4 text-xl md:text-2xl text-[#FFFFFF] italic">Makeup born from starlight and spectral vision.</p>
            <button onclick="document.getElementById('featured-section').scrollIntoView({behavior: 'smooth'})" class="mt-8 inline-block bg-[var(--color-accent-neon)] hover:bg-[#00DDEE] text-white font-semibold py-3 px-8 rounded-full transition duration-300 shadow-xl shadow-[var(--color-accent-neon)]/40 uppercase">EXPLORE THE VEIL</button>
        </div>
    </section>

    <section id="manifesto-section" class="py-16 border-b border-[var(--color-border)] relative overflow-hidden">
        <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://i.pinimg.com/736x/83/9b/1f/839b1f07a29d5f9d60bef63c0cfd1d64.jpg');"></div>
        <div class="absolute inset-0 bg-black/50"></div> 
        <div class="relative z-10 max-w-4xl mx-auto px-4 text-center">
            <h3 class="header-font text-4xl mb-6 text-[var(--color-accent-green)] uppercase">OUR MANIFESTO</h3>
            <div class="text-xl leading-relaxed font-light text-white">
                <p class="mb-4 font-semibold">Ethereal Freaks is a rebellion against the ordinary. We believe makeup is colorâ€”armor, expression, and shift.</p>
                <p class="mb-4">Inspired by the spirit of true self-expression, textures of cosmic dreams, and fantasy aesthetics.</p>
                <p class="italic font-medium text-[var(--color-accent-neon)] text-2xl">Embrace your phantom. Define your own beautiful.</p>
            </div>
        </div>
    </section>

    <main class="pt-4 pb-16">
        <!-- MARQUEE BANNER -->
        <section id="marquee-section" class="bg-[var(--color-accent-green)] py-2 marquee-container">
            <div class="marquee-content">
                <div class="marquee-text-item text-lg text-[#00AFFF] uppercase">PHANTOM SNAKE EXCLUSIVE DROP, OUT NOW!! LIMITED STOCK AVAILABLE. &nbsp;&nbsp;&nbsp;</div>
                <div class="marquee-text-item text-lg text-[#00AFFF] uppercase">PHANTOM SNAKE EXCLUSIVE DROP, OUT NOW!! LIMITED STOCK AVAILABLE. &nbsp;&nbsp;&nbsp;</div>
            </div>
        </section>
        
        <section id="featured-section" class="mb-20 pt-10 px-4 sm:px-6 lg:px-8 section-block">
            <!-- HIDDEN BANNER FOR FEATURED (Only shows when filtered) -->
            <div id="featured-banner" class="relative w-full h-64 md:h-80 mb-12 items-center justify-center overflow-hidden hidden">
                <!-- UPDATED TO PURPLE ABSTRACT -->
                <div class="absolute inset-0 bg-cover" style="background-image: url('https://i.pinimg.com/736x/9e/a7/dc/9ea7dc8b23535c12adee66728c7309af.jpg'); background-position: center 20%;"></div>
                <div class="absolute inset-0 bg-black/40"></div>
                <h3 class="relative z-10 header-font text-5xl md:text-6xl text-center text-[#D1FF66] drop-shadow-lg tracking-wider">NEW DROP</h3>
            </div>

            <h3 id="featured-title" class="header-font text-4xl mb-12 text-center text-[var(--color-accent-neon)]">FEATURED DROP</h3>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="lg:col-span-1 rounded-lg relative overflow-hidden h-[500px] shadow-lg shadow-cyan-200/50"> 
                    <div class="absolute inset-0 bg-cover bg-center" style="background-image: url('https://i.pinimg.com/736x/d2/8a/7d/d28a7ded96f5ad4ca93b55137ebd5d28.jpg');"></div>
                    <div class="relative z-10 h-full flex flex-col justify-between p-8 text-center">
                        <h4 class="header-font text-3xl text-[#D1FF66] mb-3 drop-shadow-md uppercase">PHANTOM SNAKE EXCLUSIVE</h4>
                        <div class="flex flex-col items-center space-y-4">
                            <p class="text-sm text-white drop-shadow-md -mt-16">Release now!! flagship palette of the new era.</p>
                            <button onclick="handleExclusiveBundleAdd()" class="font-semibold py-2 px-6 rounded-full text-sm uppercase bg-[var(--color-accent-green)] text-black hover:bg-[#B0E040] transition duration-200 shadow-xl cursor-pointer pointer-events-auto z-50">SHOP COLLECTION</button>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-2 grid grid-cols-1 sm:grid-cols-2 gap-8">
                    <!-- PRODUCT 1: PHANTOM SNAKE PALETTE -->
                    <div class="product-card">
                        <img src="https://m.media-amazon.com/images/I/71Z9XZWfRFL._SX679_.jpg" class="product-image-swap w-full">
                        <div class="product-content">
                            <h4 class="text-xl font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">PHANTOM SNAKE PALETTE</h4>
                            <p class="text-xs text-gray-700 my-1">4 shades of hyper-shifting multichrome and shimmer.</p>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-lg font-bold text-sm">IDR 152.000</span>
                                <div id="controls-phantom-snake-palette" data-product-id="phantom-snake-palette"></div>
                            </div>
                            <div class="mt-4 flex space-x-2">
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#c3fae8;"></div> 
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#dffc7e;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#83d4b6;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#106e4b;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- PRODUCT 2: PHANTOM SNAKE LIP MATTE CAROUSEL -->
                    <div class="product-card">
                        <div class="carousel-wrapper">
                            <div class="carousel-arrow left" onclick="changeLipShade('featured-lip-matte', -1); event.stopPropagation();">&#10094;</div>
                            <img id="featured-lip-matte-img" src="https://m.media-amazon.com/images/I/61KqU2Pc+NL._SX679_.jpg" class="product-image-swap w-full">
                            <div class="carousel-arrow right" onclick="changeLipShade('featured-lip-matte', 1); event.stopPropagation();">&#10095;</div>
                        </div>
                        <div class="product-content">
                            <h4 class="text-xl font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">PHANTOM SNAKE LIP MATTE</h4>
                            <span id="featured-lip-matte-shade" class="text-xs text-gray-700 my-1 uppercase">#S01 GINGER</span>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-lg font-bold text-sm">IDR 135.000</span>
                                <div id="controls-featured-lip-matte" data-product-id="featured-lip-matte"></div>
                            </div>
                            <div class="mt-4 flex justify-start">
                                <div id="featured-lip-matte-swatch" class="swatch-color w-8 h-8 rounded-full ring-2 ring-[var(--color-accent-neon)]" style="background-color:#633c28;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Eye Palettes Section WITH NEW BANNER (LOWERED POSITION) -->
        <section id="eyes-section" class="mb-20 pt-10 section-block">
            <!-- Full Width Banner for Eye Palettes -->
            <div class="relative w-full h-64 md:h-80 mb-12 flex items-center justify-center overflow-hidden">
                <!-- UPDATED TO EYE PICTURE -->
                <div class="absolute inset-0 bg-cover" style="background-image: url('https://i.pinimg.com/736x/a1/a7/e4/a1a7e4eba910882a3ef15a91ec2106d1.jpg'); background-position: center 25%;"></div>
                <div class="absolute inset-0 bg-black/40"></div>
                <h3 class="relative z-10 header-font text-5xl md:text-6xl text-center text-[#D1FF66] drop-shadow-lg tracking-wider">EYE PALETTES</h3>
            </div>
            
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <!-- SLOT 1 -->
                    <div class="product-card">
                        <img src="https://kaleidos.com/cdn/shop/files/003.jpg?v=1710471804&width=2160" 
                             data-original-src="https://kaleidos.com/cdn/shop/files/003.jpg?v=1710471804&width=2160"
                             data-hover-src="https://kaleidos.com/cdn/shop/files/003-t_213d1c15-13e1-4fee-9151-cc73703141e0.png?v=1710471804&width=2160"
                             alt="Starlight Shift" class="w-full product-image-swap">
                        <div class="product-content">
                            <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">STARLIGHT SHIFT PALETTE</h4>
                            <p class="text-xs text-gray-700 my-1">4 vibrant shades with duochrome properties.</p>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-lg font-bold text-sm">IDR 145.000</span>
                                <div id="controls-starlight-shift" data-product-id="starlight-shift"></div>
                            </div>
                            <div class="mt-2 flex space-x-1">
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#94757a;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#dd6de3;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#3d2b33;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#2c203d;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- SLOT 2 -->
                    <div class="product-card">
                        <img src="https://www.cheeryep.com/cdn/shop/files/05_20fce768-f63b-4d64-bc8f-b61b79d01395.png?v=1739955295&width=823" 
                             data-original-src="https://www.cheeryep.com/cdn/shop/files/05_20fce768-f63b-4d64-bc8f-b61b79d01395.png?v=1739955295&width=823"
                             data-hover-src="https://ae01.alicdn.com/kf/S8da1c5d72ad24d6d8ac69c57745e5931m.jpg"
                             alt="Futurism II: Koi Pond" class="w-full product-image-swap">
                        <div class="product-content">
                            <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">FUTURISM II: KOI POND</h4>
                            <p class="text-xs text-gray-700 my-1">16 color high-pigment collection of fluid aquatics and sunset glows inspired by the grace of water gardens.</p>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-lg font-bold text-sm">IDR 250.000</span>
                                <div id="controls-koi-pond" data-product-id="koi-pond"></div>
                            </div>
                            <div class="mt-2 flex space-x-1">
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#109477;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#1b359e;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#ffac40;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- SLOT 3 -->
                    <div class="product-card">
                        <img src="https://www.cheeryep.com/cdn/shop/files/04_0a2aa87c-2d6e-4116-b0df-a2d433f4c45c.png?v=1739955284&width=823" 
                             data-original-src="https://www.cheeryep.com/cdn/shop/files/04_0a2aa87c-2d6e-4116-b0df-a2d433f4c45c.png?v=1739955284&width=823"
                             data-hover-src="https://m.media-amazon.com/images/I/81OhL76ir7L._SX679_.jpg"
                             alt="VR Neon" class="w-full product-image-swap">
                        <div class="product-content">
                            <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">FUTURISM I: VR NEON</h4>
                            <p class="text-xs text-gray-700 my-1">16 color high-octane spectrum with electric neons and space mattes.</p>
                            <div class="flex items-center justify-between mt-2">
                                <span class="text-lg font-bold text-sm">IDR 250.000</span>
                                <div id="controls-vr-neon" data-product-id="vr-neon"></div>
                            </div>
                            <div class="mt-2 flex space-x-1">
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#FF69B4;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#32CD32;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#FFFF00;"></div>
                            </div>
                        </div>
                    </div>

                    <!-- SLOT 4 -->
                    <div class="product-card">
                        <img src="https://cbeautymall.com/cdn/shop/files/429b565c4419098bb232c1c97c626b86_d798c617-d785-4c86-9d85-ffcdb26fb9cf.png?v=1729564815" 
                             data-original-src="https://cbeautymall.com/cdn/shop/files/429b565c4419098bb232c1c97c626b86_d798c617-d785-4c86-9d85-ffcdb26fb9cf.png?v=1729564815"
                             data-hover-src="https://chicdecent.com/cdn/shop/files/Girlcult_8_Colors_Eyeshadow_Palette_Miaowu_Chic_Decent_Beauty_13.webp?v=1735114056&width=800"
                             alt="Futurism III: Miaowu" class="w-full product-image-swap">
                        <div class="product-content">
                            <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">FUTURISM III: MIAOWU</h4>
                            <p class="text-xs text-gray-700 my-1">8 color spectral curation with electric sky blues and deep midnight feline shadows.</p>
                            <div class="flex items-center justify-between mt-4">
                                <span class="text-lg font-bold text-sm">IDR 200.000</span>
                                <div id="controls-miaowu" data-product-id="miaowu"></div>
                            </div>
                            <div class="mt-2 flex space-x-1">
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#30c9fc;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#000608;"></div>
                                <div class="swatch-color w-5 h-5 rounded-full" style="background-color:#fcd372;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Lip Section -->
        <section id="lips-section" class="mb-20 pt-10 px-4 sm:px-6 lg:px-8 section-block">
            <!-- HIDDEN BANNER FOR LIPS (Only shows when filtered) -->
            <div id="lips-banner" class="relative w-full h-64 md:h-80 mb-12 items-center justify-center overflow-hidden hidden">
                <div class="absolute inset-0 bg-cover" style="background-image: url('https://i.pinimg.com/1200x/1f/f4/57/1ff4579ca9847b11903d3534a1033f8b.jpg'); background-position: center;"></div>
                <div class="absolute inset-0 bg-black/40"></div>
                <h3 class="relative z-10 header-font text-5xl md:text-6xl text-center text-[#D1FF66] drop-shadow-lg tracking-wider">LIP VEILS</h3>
            </div>

            <h3 id="lips-title" class="header-font text-4xl mb-12 text-center text-[var(--color-accent-neon)]">COSMIC VEIL LIP PRODUCTS</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <!-- CRIMSON NOCTURNE -->
                <div class="product-card">
                    <div class="carousel-wrapper">
                        <div class="carousel-arrow left" onclick="changeLipShade('crimson-nocturne', -1); event.stopPropagation();">&#10094;</div>
                        <img id="crimson-nocturne-img" src="https://m.media-amazon.com/images/I/61CNlLHXfDL._SX679_.jpg" class="product-image-swap w-full">
                        <div class="carousel-arrow right" onclick="changeLipShade('crimson-nocturne', 1); event.stopPropagation();">&#10095;</div>
                    </div>
                    <div class="product-content">
                        <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">CRIMSON NOCTURNE LIP GLOSS</h4>
                        <span id="crimson-nocturne-shade" class="text-xs text-gray-700 my-1 uppercase">J814 CARAMEL</span>
                        <p class="text-xs text-gray-700 my-1">High-shine, vinyl finish gloss with deep, mysterious red undertones.</p>
                        <div class="flex items-center justify-between mt-4">
                            <span class="text-lg font-bold text-sm">IDR 137.000</span>
                            <div id="controls-crimson-nocturne" data-product-id="crimson-nocturne"></div>
                        </div>
                        <div class="mt-4 flex justify-start"><div id="crimson-nocturne-swatch" class="swatch-color w-8 h-8 rounded-full ring-2 ring-[var(--color-accent-neon)]" style="background-color:#914c33;"></div></div>
                    </div>
                </div>

                <!-- HYNTOOR MIRROR -->
                <div class="product-card">
                    <div class="carousel-wrapper">
                        <div class="carousel-arrow left" onclick="changeLipShade('hyntoor-mirror', -1); event.stopPropagation();">&#10094;</div>
                        <img id="hyntoor-mirror-img" src="https://www.lookhealthystore.com/cdn/shop/files/O1CN01VSqIzi2HcNPNFljq9__2206926319171.jpg?v=1757666466&width=1200" class="product-image-swap w-full">
                        <div class="carousel-arrow right" onclick="changeLipShade('hyntoor-mirror', 1); event.stopPropagation();">&#10095;</div>
                    </div>
                    <div class="product-content">
                        <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">HYNTOOR MIRROR LIP GLOSS</h4>
                        <span id="hyntoor-mirror-shade" class="text-xs text-gray-700 my-1 uppercase">#00 GRAY WALL</span>
                        <p class="text-xs text-gray-700 my-1">Mirror-like finish with edgy, muted undertones for a sleek, modern look.</p>
                        <div class="flex items-center justify-between mt-4">
                            <span class="text-lg font-bold text-sm">IDR 154.000</span>
                            <div id="controls-hyntoor-mirror" data-product-id="hyntoor-mirror"></div>
                        </div>
                        <div class="mt-4 flex justify-start"><div id="hyntoor-mirror-swatch" class="swatch-color w-8 h-8 rounded-full ring-2 ring-[var(--color-accent-neon)]" style="background-color:#cfb6bf;"></div></div>
                    </div>
                </div>

                <!-- BIZARRE TALES -->
                <div class="product-card">
                    <div class="carousel-wrapper">
                        <div class="carousel-arrow left" onclick="changeLipShade('bizarre-tales', -1); event.stopPropagation();">&#10094;</div>
                        <img id="bizarre-tales-img" src="https://m.media-amazon.com/images/I/710h3aL3ITL._SX679_.jpg" class="product-image-swap w-full">
                        <div class="carousel-arrow right" onclick="changeLipShade('bizarre-tales', 1); event.stopPropagation();">&#10095;</div>
                    </div>
                    <div class="product-content">
                        <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">BIZARRE TALES LIP GLAZE</h4>
                        <span id="bizarre-tales-shade" class="text-xs text-gray-700 my-1 uppercase">J73 LETHE WATER</span>
                        <p class="text-xs text-gray-700 my-1">A collection of deep, dark, and mysterious lip glazes inspired by bizarre tales.</p>
                        <div class="flex items-center justify-between mt-4">
                            <span class="text-lg font-bold text-sm">IDR 164.000</span>
                            <div id="controls-bizarre-tales" data-product-id="bizarre-tales"></div>
                        </div>
                        <div class="mt-4 flex justify-start"><div id="bizarre-tales-swatch" class="swatch-color w-8 h-8 rounded-full ring-2 ring-[var(--color-accent-neon)]" style="background-color:#471540;"></div></div>
                    </div>
                </div>

                <!-- WILLOW WISP -->
                <div class="product-card">
                    <div class="carousel-wrapper">
                        <img id="willow-wisp-img" src="https://kaleidos.com/cdn/shop/files/1_17.png?v=1764912678&width=2160" class="product-image-swap w-full">
                    </div>
                    <div class="product-content">
                        <h4 class="text-lg font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">WILLOW WISP (SET)</h4>
                        <p class="text-xs text-gray-700 my-1">4 set of lip clays featuring misty, ethereal hues for a soft-focus, velvet finish.</p>
                        <div class="flex items-center justify-between mt-4">
                            <span class="text-lg font-bold text-sm">IDR 550.000</span>
                            <div id="controls-willow-wisp" data-product-id="willow-wisp"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Sculpt Section -->
        <section id="contour-section" class="mb-20 pt-10 px-4 sm:px-6 lg:px-8 section-block">
             <!-- HIDDEN BANNER FOR CONTOUR (Only shows when filtered) -->
             <div id="contour-banner" class="relative w-full h-64 md:h-80 mb-12 items-center justify-center overflow-hidden hidden">
                <div class="absolute inset-0 bg-cover" style="background-image: url('https://i.pinimg.com/736x/64/be/08/64be087f1d53a4ae6e41d5ca82102254.jpg'); background-position: center 100%;"></div>
                <div class="absolute inset-0 bg-black/40"></div>
                <h3 class="relative z-10 header-font text-5xl md:text-6xl text-center text-[#D1FF66] drop-shadow-lg tracking-wider">SCULPTING</h3>
            </div>

            <h3 id="contour-title" class="header-font text-4xl mb-12 text-center text-[var(--color-accent-neon)]">CHARISMA SCULPT</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="product-card col-span-1 md:col-span-2 lg:col-span-2">
                    <div class="carousel-wrapper">
                        <div class="carousel-arrow left" onclick="changeCarouselItem('symphony-contour', -1); event.stopPropagation();">&#10094;</div>
                        <img id="symphony-contour-img" src="https://kaleidos.com/cdn/shop/files/s00.jpg?v=1721124306&width=2160" class="product-image-swap w-full">
                        <div class="carousel-arrow right" onclick="changeCarouselItem('symphony-contour', 1); event.stopPropagation();">&#10095;</div>
                    </div>
                    <div class="product-content">
                        <h4 class="text-xl font-medium text-[var(--color-accent-neon)] uppercase mt-0 mb-0">SYMPHONY CONTOUR TRIO</h4>
                        <span id="symphony-contour-shade" class="text-xs text-gray-700 my-1 uppercase">FAIR</span>
                        <div class="flex items-center justify-between mt-4">
                            <span class="text-lg font-bold text-sm">IDR 199.000</span>
                             <div id="controls-symphony-contour" data-product-id="symphony-contour"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section id="oceanic-realm" class="mb-20 pt-10 px-4 sm:px-6 lg:px-8">
            <div id="reflex-game-container">
                <h3 class="header-font text-4xl mb-2 text-white">COSMIC REFLEX CHALLENGE</h3>
                <p id="difficulty-display" class="text-sm font-bold text-[var(--color-accent-green)] mb-1 uppercase tracking-wide">TODAY'S LEVEL: </p>
                <p class="text-xs text-white mb-6">Stop the marker in the GREEN ZONE to win a Voucher! (Once daily)</p>
                
                <div class="reflex-track">
                    <div class="reflex-zone-near" id="zone-near"></div>
                    <div class="reflex-zone-win" id="zone-win"></div>
                    <div class="reflex-cursor" id="reflex-cursor"></div>
                </div>
                
                <button id="reflex-btn" class="game-btn" onclick="handleGameAction()">START</button>
                <p id="reflex-msg" class="text-white mt-4 font-bold text-lg h-8"></p>
            </div>
        </section>
    </main>

    <footer class="bg-[var(--color-card-bg)] mt-16 py-10 border-t border-[var(--color-border)] shadow-inner text-center">
        <h4 class="header-font text-2xl text-[var(--color-accent-neon)] mb-4">ETHEREAL FREAKS</h4>
        <p class="text-xs text-[#666666]">&copy; 2025 Ethereal Freaks. All rights reserved.</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let db, auth, userId, cartRef;
        // LOCAL CART FALLBACK
        window.localCart = {}; 
        
        const cartLink = document.getElementById('cart-link');

        async function initFirebase() {
            try {
                const config = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                // Check if config exists
                if (!config.apiKey) throw new Error("No config");
                
                const app = initializeApp(config);
                db = getFirestore(app);
                auth = getAuth(app);
                onAuthStateChanged(auth, async (user) => {
                    if (user) userId = user.uid;
                    else {
                        const token = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
                        if (token) await signInWithCustomToken(auth, token); else await signInAnonymously(auth);
                        userId = auth.currentUser?.uid;
                    }
                    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
                    cartRef = doc(db, `artifacts/${appId}/users/${userId}/cart/items`); 
                    
                    // Initial load
                    setupLipCarousel();
                    initDailyGameConfig();
                    checkDailyGame();
                    
                    // Listen
                    onSnapshot(cartRef, (docSnap) => {
                        const data = docSnap.exists() ? docSnap.data() : {};
                        // Sync firebase data to local variable
                        window.localCart = data;
                        updateCartUI();
                    });
                });
            } catch (e) { 
                console.warn("Firebase failed, using local cart.", e);
                setupLipCarousel();
                initDailyGameConfig();
                checkDailyGame();
            }
        }

        function updateCartUI() {
            const data = window.localCart;
            const totalCount = Object.values(data).reduce((acc, item) => acc + item.quantity, 0);
            cartLink.textContent = `CART (${totalCount})`;
            
            // Update all product buttons
            document.querySelectorAll('[data-product-id]').forEach(control => {
                const id = control.getAttribute('data-product-id');
                // Calculate total quantity for this product ID (sum of all shades)
                let qty = 0;
                Object.values(data).forEach(item => {
                    if(item.productId === id) qty += item.quantity;
                });
                
                if (qty === 0) {
                     control.innerHTML = `<button class="initial-cart-btn text-black py-1 px-3 rounded-full text-lg font-bold shadow-md" onclick="handleAddClick(event, '${id}')">ðŸ›’</button>`;
                } else {
                     control.innerHTML = `
                        <div class="quantity-control shadow-md">
                            <button class="quantity-btn" onclick="handleAddClick(event, '${id}', -1)">-</button>
                            <span class="quantity-display">${qty}</span>
                            <button class="quantity-btn" onclick="handleAddClick(event, '${id}', 1)">+</button>
                        </div>
                    `;
                }
            });

            renderCartItems(data);
        }

        window.addToCart = async (productId, shade, price, img, name, delta = 1) => {
            const key = `${productId}_${shade.replace(/\s+/g, '')}`;
            
            if (window.localCart[key]) {
                window.localCart[key].quantity += delta;
                if (window.localCart[key].quantity <= 0) delete window.localCart[key];
            } else if (delta > 0) {
                window.localCart[key] = {
                    productId, shade, price, img, name, quantity: 1
                };
            }
            
            updateCartUI();
            
            if (cartRef) {
                try { await setDoc(cartRef, window.localCart); } catch(e) {}
            }
        }
        
        window.handleAddClick = (e, productId, delta = 1) => {
             e.stopPropagation(); // Stop event bubbling
             // 1. Check if it's a dynamic shade product
             if (currentShadeState[productId]) {
                 // Use current shade logic
                 addCurrentShadeToCart(productId, getPriceForId(productId), getNameForId(productId), delta);
             } else {
                 // Static product (phantom palette, etc) - use defaults
                 const staticData = getStaticProductData(productId);
                 if (staticData) {
                     addToCart(productId, 'Standard', staticData.price, staticData.img, staticData.name, delta);
                 }
             }
        }
        
        window.addCurrentShadeToCart = async (productId, price, name, delta = 1) => {
             const state = currentShadeState[productId];
             if (!state) return;
             const shadeName = state.data[state.idx].name;
             const img = state.data[state.idx].img;
             await addToCart(productId, shadeName, price, img, name, delta);
        };
        
        function getPriceForId(id) {
            // Mapping for dynamic prices
            if(id === 'featured-lip-matte') return 135000;
            if(id === 'crimson-nocturne') return 137000;
            if(id === 'bizarre-tales') return 164000;
            if(id === 'hyntoor-mirror') return 154000;
            if(id === 'willow-wisp') return 550000;
            if(id === 'symphony-contour') return 199000;
            return 0;
        }
        function getNameForId(id) {
            if(id === 'featured-lip-matte') return 'Phantom Snake Lip Matte';
            if(id === 'crimson-nocturne') return 'Crimson Nocturne Lip Gloss';
            if(id === 'bizarre-tales') return 'Bizarre Tales Lip Glaze';
            if(id === 'hyntoor-mirror') return 'Hyntoor Mirror Lip Gloss';
            if(id === 'willow-wisp') return 'Willow Wisp Set';
            if(id === 'symphony-contour') return 'Symphony Contour Trio';
            return 'Product';
        }
        function getStaticProductData(id) {
             // Hardcoded lookup for static products
             if(id === 'phantom-snake-palette') return { price: 152000, img: 'https://m.media-amazon.com/images/I/71Z9XZWfRFL._SX679_.jpg', name: 'Phantom Snake Palette' };
             if(id === 'starlight-shift') return { price: 145000, img: 'https://kaleidos.com/cdn/shop/files/003.jpg?v=1710471804&width=2160', name: 'Starlight Shift Palette' };
             if(id === 'koi-pond') return { price: 250000, img: 'https://www.cheeryep.com/cdn/shop/files/05_20fce768-f63b-4d64-bc8f-b61b79d01395.png?v=1739955295&width=823', name: 'Futurism II: Koi Pond' };
             if(id === 'vr-neon') return { price: 250000, img: 'https://www.cheeryep.com/cdn/shop/files/04_0a2aa87c-2d6e-4116-b0df-a2d433f4c45c.png?v=1739955284&width=823', name: 'Futurism I: VR Neon' };
             if(id === 'miaowu') return { price: 200000, img: 'https://cbeautymall.com/cdn/shop/files/429b565c4419098bb232c1c97c626b86_d798c617-d785-4c86-9d85-ffcdb26fb9cf.png?v=1729564815', name: 'Futurism III: Miaowu' };
             if(id === 'agave') return { price: 135000, img: 'https://placehold.co/400x400/F0F0F0/7B68EE', name: 'Agave (Muted Brown)' };
             if(id === 'poppy') return { price: 135000, img: 'https://placehold.co/400x400/F0F0F0/B03060', name: 'Poppy (Dusty Pink)' };
             if(id === 'lip-tonic') return { price: 135000, img: 'https://placehold.co/400x400/F0F0F0/808080', name: 'Lip Tonic (Glow Phantom)' };
             if(id === 'setting-powder') return { price: 500000, img: 'https://placehold.co/400x400/F0F0F0/2A2A2A', name: 'Sands of Time Powder' };
             if(id === 'ray-rider') return { price: 400000, img: 'https://placehold.co/400x400/F0F0F0/404040', name: 'Ray Rider Highlighter' };
             
             return null;
        }


        window.toggleCart = () => {
            document.getElementById('cart-sidebar').classList.toggle('open');
        };

        window.renderCartItems = (data) => {
            const items = data || window.localCart;
            const container = document.getElementById('cart-items-container');
            const totalEl = document.getElementById('cart-total');
            const useCoins = document.getElementById('use-coins').checked;
            
            container.innerHTML = '';
            let subtotal = 0;
            let hasItems = false;
            
            Object.entries(items).forEach(([key, item]) => {
                hasItems = true;
                subtotal += item.price * item.quantity;
                container.innerHTML += `
                    <div class="cart-item">
                        <img src="${item.img}" alt="${item.name}">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm">${item.name}</h4>
                            <p class="text-xs text-gray-500">${item.shade}</p>
                            <div class="flex justify-between items-center mt-2">
                                <span class="font-medium">IDR ${item.price.toLocaleString()}</span>
                                <div class="flex items-center gap-2">
                                    <button class="px-2 bg-gray-200 rounded" onclick="updateQty('${key}', -1)">-</button>
                                    <span class="text-xs">${item.quantity}</span>
                                    <button class="px-2 bg-gray-200 rounded" onclick="updateQty('${key}', 1)">+</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            if (!hasItems) container.innerHTML = '<p class="text-center mt-10 text-gray-400">Your cart is empty.</p>';
            
            let total = subtotal;
            if (useCoins && subtotal > 10000) total = Math.max(0, total - 10000);
            
            totalEl.innerText = `IDR ${total.toLocaleString()}`;
        };
        
        window.updateQty = async (key, delta) => {
             if (window.localCart[key]) {
                 window.localCart[key].quantity += delta;
                 if (window.localCart[key].quantity <= 0) delete window.localCart[key];
                 updateCartUI();
                 if (cartRef) await setDoc(cartRef, window.localCart);
             }
        };

        window.openCheckout = () => {
             document.getElementById('checkout-modal').style.display = 'flex';
             document.getElementById('cart-sidebar').classList.remove('open');
        };
        
        window.closeModal = (id) => {
            document.getElementById(id).style.display = 'none';
        };
        
        window.handleExclusiveBundleAdd = async () => {
             // 1. Add Palette
             const palData = getStaticProductData('phantom-snake-palette');
             await addToCart('phantom-snake-palette', 'Standard', palData.price, palData.img, palData.name);
             
             // 2. Add Current Lip
             const lipState = currentShadeState['featured-lip-matte'];
             const shade = lipState.data[lipState.idx].name;
             const img = lipState.data[lipState.idx].img;
             await addToCart('featured-lip-matte', shade, 135000, img, 'Phantom Snake Lip Matte');
             
             // Open cart for bundle add
             document.getElementById('cart-sidebar').classList.add('open');
        };

        window.filterCategory = function(type) {
            const hero = document.getElementById('hero-section');
            const manifesto = document.getElementById('manifesto-section');
            const marquee = document.getElementById('marquee-section');
            const featured = document.getElementById('featured-section');
            const eyes = document.getElementById('eyes-section');
            const lips = document.getElementById('lips-section');
            const contour = document.getElementById('contour-section');
            const oceanic = document.getElementById('oceanic-realm');
            const catBanner = document.getElementById('category-banner');
            const catTitle = document.getElementById('category-title');

            window.scrollTo(0,0);

            // Handle Eye Palettes specifically
            if (type === 'eyes') {
                hero.style.display = 'none';
                manifesto.style.display = 'none';
                marquee.style.display = 'none';
                featured.style.display = 'none';
                eyes.style.display = 'block';
                lips.style.display = 'none';
                contour.style.display = 'none';
                oceanic.style.display = 'none';
                // Don't show generic banner because eyes section has its own fancy banner
                catBanner.style.display = 'none'; 
                
                // Toggle New Drop Banner Logic
                document.getElementById('featured-banner').style.display = 'none';
                document.getElementById('featured-title').style.display = 'block';
                // Toggle Lip Banner Logic
                document.getElementById('lips-banner').style.display = 'none';
                document.getElementById('lips-title').style.display = 'block';
                // Toggle Contour Banner Logic
                document.getElementById('contour-banner').style.display = 'none';
                document.getElementById('contour-title').style.display = 'block';
                
                return;
            }

            if (type === 'all') {
                hero.style.display = 'flex';
                manifesto.style.display = 'block';
                marquee.style.display = 'block';
                featured.style.display = 'block';
                eyes.style.display = 'block';
                lips.style.display = 'block';
                contour.style.display = 'block';
                oceanic.style.display = 'block';
                catBanner.style.display = 'none';
                
                // Reset Featured Banner Logic
                document.getElementById('featured-banner').style.display = 'none';
                document.getElementById('featured-title').style.display = 'block';
                // Reset Lip Banner Logic
                document.getElementById('lips-banner').style.display = 'none';
                document.getElementById('lips-title').style.display = 'block';
                // Reset Contour Banner Logic
                document.getElementById('contour-banner').style.display = 'none';
                document.getElementById('contour-title').style.display = 'block';
                
            } else {
                hero.style.display = 'none';
                manifesto.style.display = 'none';
                marquee.style.display = 'none';
                featured.style.display = 'none';
                eyes.style.display = 'none';
                lips.style.display = 'none';
                contour.style.display = 'none';
                oceanic.style.display = 'none';
                
                catBanner.style.display = 'block';
                
                if (type === 'featured') {
                    featured.style.display = 'block';
                    // Toggle Special Banner
                    document.getElementById('featured-banner').style.display = 'flex';
                    document.getElementById('featured-title').style.display = 'none';
                    catBanner.style.display = 'none'; 
                } else if (type === 'lips') {
                    lips.style.display = 'block';
                    // Toggle Special Banner
                    document.getElementById('lips-banner').style.display = 'flex';
                    document.getElementById('lips-title').style.display = 'none';
                    catBanner.style.display = 'none';
                } else if (type === 'contour') {
                    contour.style.display = 'block';
                    // Toggle Special Banner
                    document.getElementById('contour-banner').style.display = 'flex';
                    document.getElementById('contour-title').style.display = 'none';
                    catBanner.style.display = 'none';
                }
            }
        };

        // --- GAME LOGIC ---
        let gameActive = false;
        let gameInterval;
        let direction = 1;
        let position = 0;
        let dailySpeed = 3; 
        let dailyTargetPercent = 50;

        function getDailySeed() {
            const d = new Date();
            return d.getFullYear() * 10000 + (d.getMonth() + 1) * 100 + d.getDate();
        }
        function seededRandom(seed) {
            var x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }

        window.initDailyGameConfig = function() {
            const seed = getDailySeed();
            const randomPos = seededRandom(seed); 
            dailyTargetPercent = 20 + (randomPos * 60);
            const randomDiff = seededRandom(seed + 1);
            let difficultyName = "NORMAL";
            if (randomDiff < 0.5) { dailySpeed = 3; difficultyName = "NORMAL"; } 
            else if (randomDiff < 0.85) { dailySpeed = 5; difficultyName = "HARD"; } 
            else { dailySpeed = 8; difficultyName = "SUPER HARD"; }

            const zoneWin = document.getElementById('zone-win');
            const zoneNear = document.getElementById('zone-near');
            const diffText = document.getElementById('difficulty-display');

            if(zoneWin) zoneWin.style.left = dailyTargetPercent + '%';
            if(zoneNear) zoneNear.style.left = dailyTargetPercent + '%';
            if(diffText) diffText.innerText = "TODAY'S LEVEL: " + difficultyName;
        };

        window.handleGameAction = function() {
            const btn = document.getElementById('reflex-btn');
            if (btn.innerText === "START") startGame(); else if (btn.innerText === "STOP") stopGame();
        };

        window.checkDailyGame = function() {
             const todayStr = new Date().toDateString();
             const lastPlayedStr = localStorage.getItem('lastReflexDate');
             const btn = document.getElementById('reflex-btn');
             const msg = document.getElementById('reflex-msg');
             if (lastPlayedStr === todayStr) {
                 btn.disabled = true; btn.innerText = "PLAYED"; btn.style.backgroundColor = "#555";
                 msg.innerText = "Come back tomorrow!";
             }
        };
        
        window.closeClaimModal = function() {
            document.getElementById('claim-modal').style.display = 'none';
        }

        function startGame() {
            const btn = document.getElementById('reflex-btn');
            btn.innerText = "STOP";
            gameActive = true;
            position = 0; 
            const cursor = document.getElementById('reflex-cursor');
            const containerWidth = document.querySelector('.reflex-track').offsetWidth;
            gameInterval = setInterval(() => {
                position += dailySpeed * direction;
                if (position >= containerWidth - 6 || position <= 0) direction *= -1;
                cursor.style.left = position + 'px';
            }, 10);
        }

        function stopGame() {
            clearInterval(gameInterval);
            gameActive = false;
            const btn = document.getElementById('reflex-btn');
            const msg = document.getElementById('reflex-msg');
            const cursor = document.getElementById('reflex-cursor');
            const trackWidth = document.querySelector('.reflex-track').offsetWidth;
            const targetPixel = (dailyTargetPercent / 100) * trackWidth;
            const currentPos = parseInt(cursor.style.left || 0);
            const distance = Math.abs(currentPos - targetPixel);
            const winThreshold = trackWidth * 0.025; 
            const nearThreshold = trackWidth * 0.15; 
            
            let resultText = "", prizeText = "";
            if (distance <= winThreshold) { prizeText = "VOUCHER: COSMIC20"; resultText = "PERFECT!"; } 
            else if (distance <= nearThreshold) { prizeText = "10 COINS"; resultText = "Close!"; } 
            else { prizeText = "5 COINS"; resultText = "Good effort!"; }
            
            document.getElementById('claim-prize-text').innerText = prizeText;
            document.getElementById('claim-modal').style.display = 'flex';
            fireConfetti();
            btn.disabled = true; btn.innerText = "DONE"; btn.style.backgroundColor = "#555";
            msg.innerText = resultText;
            localStorage.setItem('lastReflexDate', new Date().toDateString());
        }
        
        function fireConfetti() {
            const container = document.getElementById('confetti-container');
            container.innerHTML = ''; 
            const colors = ['#D1FF66', '#00AFFF', '#FF6B6B', '#FFE66D', '#FFFFFF'];
            for (let i = 0; i < 100; i++) {
                const confetto = document.createElement('div');
                confetto.className = 'confetto';
                confetto.style.left = '50%'; confetto.style.top = '50%';
                confetto.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetto.style.animationDelay = Math.random() * 0.5 + 's';
                const x = (Math.random() - 0.5) * 800 + 'px';
                const y = (Math.random() - 1) * 800 + 'px';
                const rotate = Math.random() * 360 + 'deg';
                confetto.style.setProperty('--x', x); confetto.style.setProperty('--y', y); confetto.style.setProperty('--r', rotate);
                container.appendChild(confetto);
            }
        }

        const crimsonShades = [
            { img: 'https://m.media-amazon.com/images/I/61CNlLHXfDL._SX679_.jpg', name: 'J814 CARAMEL', code: '#914c33' },
            { img: 'https://m.media-amazon.com/images/I/61Swjq7JvFL._SX679_.jpg', name: 'J815 CLEAR SHIMMER', code: '#824a42' },
            { img: 'https://m.media-amazon.com/images/I/61iWp3x9iuL._SX679_.jpg', name: 'J816 SCARLET VEIL', code: '#332020' }
        ];

        const bizarreTalesShades = [
            { img: 'https://m.media-amazon.com/images/I/710h3aL3ITL._SX679_.jpg', name: 'J73 LETHE WATER', code: '#471540' },
            { img: 'https://m.media-amazon.com/images/I/718bTr3BjuL._SX679_.jpg', name: 'J74 DEMENTOR', code: '#2b0e0e' },
            { img: 'https://m.media-amazon.com/images/I/71wVFrE7ryL._SX679_.jpg', name: 'J75 FIREFLY', code: '#0e2e28' },
            { img: 'https://m.media-amazon.com/images/I/71uqiJfMNmL._SX679_.jpg', name: 'J76 SPIDERS', code: '#0f4e69' },
            { img: 'https://m.media-amazon.com/images/I/71u3fqnOZ8L._SX679_.jpg', name: 'J79 DESPERATE', code: '#14091c' }
        ];

        const hyntoorShades = [
            { img: 'https://www.lookhealthystore.com/cdn/shop/files/O1CN01VSqIzi2HcNPNFljq9__2206926319171.jpg?v=1757666466&width=1200', name: '#00 GRAY WALL', code: '#cfb6bf' },
            { img: 'https://www.lookhealthystore.com/cdn/shop/files/O1CN01Lk7peR2HcNPP9Wa7g__2206926319171.jpg?v=1757666605&width=1200', name: '#094 ASH PURPLE', code: '#5e535e' },
            { img: 'https://www.lookhealthystore.com/cdn/shop/files/O1CN01S9uTLM2HcNPPiEmuu__2206926319171.jpg?v=1757666862&width=1200', name: '#096 CEMENT GRAY', code: '#917c83' },
            { img: 'https://www.lookhealthystore.com/cdn/shop/files/O1CN01UBW1oL2HcNPNeIGwA__2206926319171.jpg?v=1757667016&width=1200', name: '#097 MIRROR BLACK', code: '#000000' },
            { img: 'https://www.lookhealthystore.com/cdn/shop/files/O1CN0101cFp32HcNPOaqVNV__2206926319171.jpg?v=1757667164&width=1200', name: '#099 METALLIC SILVER', code: '#ebd5d5' }
        ];

        const lipShades = [
            { img: 'https://m.media-amazon.com/images/I/61KqU2Pc+NL._SX679_.jpg', name: '#S01 GINGER', code: '#633c28' },
            { img: 'https://m.media-amazon.com/images/I/61c6dYAVDXL._SX679_.jpg', name: '#S02 COCOA WHISPER', code: '#7a2f2a' },
            { img: 'https://m.media-amazon.com/images/I/615L8BC7+wL._SX679_.jpg', name: '#S04 FENNEL', code: '#7a372a' },
            { img: 'https://m.media-amazon.com/images/I/611XP1+jSTL._SX679_.jpg', name: '#S05 SUNSET TERRA', code: '#52221f' },
            { img: 'https://m.media-amazon.com/images/I/61AB+iU4cSL._SX679_.jpg', name: '#S06 ADOBE SPICE', code: '#52191d' },
            { img: 'https://m.media-amazon.com/images/I/61qRJ+lKdsL._SX679_.jpg', name: '#S07 MOSSY GLEAM', code: '#3d2316' }
        ];

        const willowWispImages = [
            'https://kaleidos.com/cdn/shop/files/1_17.png?v=1764912678&width=2160',
            'https://kaleidos.com/cdn/shop/files/05-5_a75c5fd5-0a9b-4e31-aac2-8885e8dfd084.png?v=1764912678&width=2160'
        ];

        const symphonyShades = [
            { img: 'https://kaleidos.com/cdn/shop/files/s00.jpg?v=1721124306&width=2160', name: 'FAIR' },
            { img: 'https://kaleidos.com/cdn/shop/files/s01.jpg?v=1765489351&width=2160', name: 'LIGHT' },
            { img: 'https://kaleidos.com/cdn/shop/files/s02.jpg?v=1765901559&width=2160', name: 'MEDIUM' },
            { img: 'https://kaleidos.com/cdn/shop/files/s03_ef55903f-d3d1-444d-9dd1-cd1478301789.jpg?v=1765901453&width=2160', name: 'TAN' },
            { img: 'https://kaleidos.com/cdn/shop/files/s04.jpg?v=1765901183&width=2160', name: 'DARK' },
            { img: 'https://kaleidos.com/cdn/shop/files/s05.jpg?v=1765900961&width=2160', name: 'DEEP' }
        ];

        let currentShadeState = {
            'crimson-nocturne': { idx: 0, data: crimsonShades },
            'bizarre-tales': { idx: 0, data: bizarreTalesShades },
            'hyntoor-mirror': { idx: 0, data: hyntoorShades },
            'featured-lip-matte': { idx: 0, data: lipShades },
            'lip-matte-carousel': { idx: 0, data: lipShades },
            'symphony-contour': { idx: 0, data: symphonyShades }
        };

        function updateCarouselDisplay(productId, index) {
            // Safety check if product exists in DOM
            if (!document.getElementById(`${productId}-img`)) return;
            
            let data = currentShadeState[productId].data[index];

            const imgEl = document.getElementById(`${productId}-img`);
            const shadeEl = document.getElementById(`${productId}-shade`);
            const swatchEl = document.getElementById(`${productId}-swatch`); 

            if (imgEl) {
                imgEl.style.opacity = 0;
                setTimeout(() => {
                    imgEl.src = data.img;
                    imgEl.style.opacity = 1;
                }, 100); 
            }
            if (shadeEl) shadeEl.textContent = data.name;
            if (swatchEl && data.code) swatchEl.style.backgroundColor = data.code;
        }
        
        window.changeCarouselItem = (productId, delta) => {
            let state = currentShadeState[productId];
            if (state) {
                state.idx = (state.idx + delta + state.data.length) % state.data.length;
                updateCarouselDisplay(productId, state.idx);
            }
        }
        
        window.changeLipShade = window.changeCarouselItem;

        function setupLipCarousel() {
            Object.keys(currentShadeState).forEach(id => {
                updateCarouselDisplay(id, 0);
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            const swatchContainer = document.getElementById('swatch-trail-container');
            let currentColors = ['#00AFFF', '#00DDEE'];
            document.addEventListener('mousemove', (e) => {
                if (Math.random() < 0.2) {
                    const b = document.createElement('div');
                    b.className = 'swatch-blob';
                    b.style.backgroundColor = currentColors[Math.floor(Math.random() * currentColors.length)];
                    b.style.left = `${e.clientX}px`; b.style.top = `${e.clientY}px`;
                    swatchContainer.appendChild(b);
                    requestAnimationFrame(() => {
                        b.style.opacity = '1';
                        b.style.transition = 'transform 1.5s ease-out, opacity 1.5s ease-in';
                        b.style.transform = `translate(${randomInt(-100, 100)}px, ${randomInt(-100, 100)}px) scale(0.5)`;
                        b.style.opacity = '0';
                    });
                    setTimeout(() => b.remove(), 1500);
                }
            });
            function randomInt(min, max) { return Math.floor(Math.random() * (max - min + 1) + min); }

            document.querySelectorAll('.product-card').forEach(card => {
                const img = card.querySelector('.product-image-swap');
                
                if (img && img.id === 'willow-wisp-img') {
                     const originalSrc = willowWispImages[0];
                     const hoverSrc = willowWispImages[1];
                     card.addEventListener('mouseenter', () => { img.style.opacity = 0; setTimeout(() => { img.src = hoverSrc; img.style.opacity = 1; }, 150); });
                     card.addEventListener('mouseleave', () => { img.style.opacity = 0; setTimeout(() => { img.src = originalSrc; img.style.opacity = 1; }, 150); });
                } else {
                    card.addEventListener('mouseenter', () => {
                        const sw = card.querySelectorAll('.swatch-color');
                        if (sw.length) currentColors = Array.from(sw).map(s => s.style.backgroundColor);
                        if (img && img.dataset.hoverSrc) { img.style.opacity = 0; setTimeout(() => { img.src = img.dataset.hoverSrc; img.style.opacity = 1; img.style.objectFit = 'cover'; }, 150); }
                    });
                    card.addEventListener('mouseleave', () => {
                        currentColors = ['#00AFFF', '#00DDEE'];
                        if (img && img.dataset.originalSrc) { img.style.opacity = 0; setTimeout(() => { img.src = img.dataset.originalSrc; img.style.opacity = 1; img.style.objectFit = 'contain'; }, 150); }
                    });
                }
                
                card.addEventListener('mousemove', (e) => {
                    const r = card.getBoundingClientRect();
                    const x = (r.width/2 - (e.clientX-r.left))/25, y = ((e.clientY-r.top) - r.height/2)/25;
                    card.style.transform = `perspective(1000px) rotateX(${y}deg) rotateY(${x}deg) scale(1.01)`;
                    card.style.boxShadow = `${-xAxis * 2}px ${-yAxis * 2}px 30px rgba(0, 175, 255, 0.4), 0 10px 30px rgba(0, 175, 255, 0.4)`;
                });
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0)';
                    card.style.boxShadow = '0 5px 15px rgba(0, 0, 0, 0.05)';
                });
            });
        });
    </script>
</body>
</html>